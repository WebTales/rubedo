<!DOCTYPE html>
<html lang="{{lang}}">
	<head>
		{% block pageTitle %}
		<title>Rubedo Project, from WebTales</title>
		{% endblock %}

		{% block pageMeta %}
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="The Rubedo Project, open-source CMS with Zend Framework, MongoDB and Ext-JS">
		<meta name="author" content="WebTales">
		{% endblock %}

		{% block pageStyle %}
		<!-- Le styles -->
		{% for sheet in css %}
		<link href="{{sheet}}" rel="stylesheet" />
		{% endfor %}

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		{% endblock %}

		{% block pageIcons %}
		<!-- Le fav and touch icons -->
		<link rel="shortcut icon" href="../assets/ico/favicon.ico">
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
		<link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
		{% endblock %}

	</head>

	<body>
		{% block topSpace %}
		<div id="topSpace" class="navbar navbar-fixed-top"></div>
		{% endblock %}

		<div class="container-fluid">

			{% block pageModals %}

			<div class="modal hide fade" id="about">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						×
					</button>
					<h3>A propos</h3>
				</div>

				<div class="modal-body">
					<p>
						Rubedo est un logiciel open-source de gestion de contenus, développé et maintenu par la société WebTales.
					</p>
					<p>
						Rubedo est en phase active de développement.
					</p>
					<p>
						Le projet est soutenu par l'incubateur de l'Ecole Centrale Paris, et hébergé dans ses locaux.
					</p>
				</div>
				<div class="modal-footer">
					<a href="#" class="btn" data-dismiss="modal">Fermer</a>
				</div>

			</div>

			<div class="modal hide fade" id="connect">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						×
					</button>
					<h3>Connexion</h3>
				</div>

				<form class="form-horizontal" id="connectForm">
					<div class="control-group">
						<label class="control-label" for="inputEmail">E-mail</label>
						<div class="controls">
							<input type="text" id="inputEmail" placeholder="Email" value="">
							<span class="help-inline" id="connect-msg"></span>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputPassword">Mot de passe</label>
						<div class="controls">
							<input type="password" id="inputPassword" placeholder="Password" value="">
						</div>
					</div>
					<div class="control-group">
						<div class="controls">
							<label class="checkbox">
								<input type="checkbox">
								Maintenir la connexion </label>
						</div>
					</div>
					<div class="modal-footer">
						<button type="submit" class="btn btn-primary">
							Se connecter
						</button>
						<button type="button" class="btn" data-dismiss="modal">
							Annuler
						</button>
					</div>
				</form>

			</div>

			<div class="modal hide fade" id="confirm">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						×
					</button>
					<h3>Alerte</h3>
				</div>

				<div class="modal-body">
					<p>
						Vous êtes sur le point de perdre toutes les modifications effectuées
					</p>
				</div>
				<div class="modal-footer">
					<button class="btn btn-primary" id="cancel-confirm" data-dismiss="modal">
						Confirmer
					</button>
					<a href="#" class="btn" data-dismiss="modal">Annuler</a>
				</div>

			</div>

			<div class="modal hide" id="addContentForm" style="width:660px;height:390px;">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						×
					</button>
					<h3>Ajouter un </h3>
				</div>
				<div class="modal-body"></div>
			</div>
			<div class="btn-group hide" id="blockToolBar" style="position: absolute; z-index: 999;">
				<a class="btn dropdown-toggle" data-toggle="dropdown" href="#"> <i class="icon-plus"></i> <span class="caret"></span> </a>
				<ul class="dropdown-menu" id="contentType">
					<li>
						<a href="article">Article</a>
					</li>
					<li>
						<a href="news">News</a>
					</li>
				</ul>
			</div>
			{% endblock %}
			{% block pageContentToolBar %}
			<div class="navbar hide navbar-fixed-top" id="contentToolBar">
				<div class="navbar-inner">
					<div class="container-fluid">
						<!-- .btn-navbar is used as the toggle for collapsed navbar content -->
						<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a>
						<a class="brand" href="#">Administration</a>
						<div id='viewmode'>
							<div class="btn-group pull-left">
								<a class="btn" href="#" id="btn-edit"> <i class="icon-edit"></i> Editer la page </a>
							</div>
							<span class="label label-success pull-right">Consultation</span>
						</div>
						<div id='editmode' class='hide'>

							<a class="btn pull-left" href="#" id="btn-cancel"> <i class="icon-remove"></i> Annuler </a>
							<a class="btn pull-left" href="#" id="btn-save"> <i class="icon-ok"></i> Sauvegarder les modifications </a>

							<span class="label label-warning pull-right">Edition</span>
						</div>
					</div>
				</div>
			</div>
			{% endblock %}

			{% block pageMainContent %}

			<div class="container-fluid">
				{% if rows %}
				{% for row in rows %}
				{% include 'root/row.html' with row only %}
				{% endfor %}
				{% endif %}
			</div>
			{% endblock %}

		</div><!--/.fluid-container-->

		{% block pageJavascript %}
		<!-- Le javascript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		{% for file in js %}
		<script src="{{file}}"></script>
		{% endfor %}

		{% if isLoggedIn %}
		<script src="/ckeditor-dev/ckeditor.js"></script>
		<!--<script src="/extjs-4.1.1/ext-all.js"></script>-->
		<!--<script src="/js/jquery.jeditable.mini.js"></script>-->
		{% endif %}
		
		<script type="text/javascript">
			$(document).ready(function() {
				$('#contentType a').click(function(event) {
					$('#addContentForm').modal();
					<!-- todo : put real url for editing contents -->
					var
					url = 'http://rubedo-bo.local/test.html';
					$('#addContentForm .modal-body').html('<iframe width="100%" height="100%" frameborder="0" scrolling="no" allowtransparency="true" src="' + url + '"></iframe>');
					event.preventDefault();
				});
				$('#themeChooser a').click(function(event) {
					$.getJSON('/xhr-theme/define-theme?theme=' + $(this).attr('href'), function(data) {
						if (data.success)
							location.reload();
					});
					event.preventDefault();
				});
				$('#langChooser a').click(function(event) {

					$.getJSON('/xhr-language/define-language?language=' + $(this).attr('href'), function(data) {
						if (data.success)
							location.reload();
					});
					event.preventDefault();
				});
				$('#connect').submit(function() {
					$.post('/xhr-authentication/login', {
						"login" : $('#inputEmail').val(),
						"password" : $('#inputPassword').val()
					}, function(data) {
						if (data.success) {
							$(this).modal('hide');
							location.reload();
						} else {
							$("#connect-msg").html('Identifiants incorrects');
						}
					}, "json");
					return false;
				});
				$.getJSON('/xhr-authentication/is-logged-in', function(data) {
					if (data.loggedIn) {
						$('#connect-btn').html('<a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-user"></i> ' + data.username + ' <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="#">Mon compte</a></li><li class="divider"></li><li><a href="/backoffice/" >Accès Back Office</a></li><li class="divider"></li><li><a href="#" id="logout">Se déconnecter</a></li></ul>');
						$.getScript('/xhr-javascript/get-script?script=rubedo-edit', function() {

						});
						$('#logout').click(function() {
							$.getJSON('/xhr-authentication/logout/', function(data) {
								if (data.success) {
									location.reload();
								}
							});
							return false;
						});
					} else {
						$('#connect-btn').html('<a class="btn" data-toggle="modal" href="#connect"><i class="icon-user"></i> Connexion</a>');
					}
				});
			});
		</script>
		{% endblock %}
	</body>
</html>